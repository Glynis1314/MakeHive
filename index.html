<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MakeHive - Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .categories .circle, .recommendations .product, #businessList .product {
      cursor: pointer; transition: transform 0.2s;
    }
    .categories .circle:hover, .recommendations .product:hover, #businessList .product:hover { transform: scale(1.05); }
    #businessList .product img { display: block; margin: auto; }
    #businessList .product button { margin-top: 5px; padding: 5px 10px; border:none; border-radius:15px; background:#ff4081; color:white; cursor:pointer; transition:0.3s; }
    #businessList .product button:hover { background:#e73370; }
    #businessList .product .seller { font-size:0.85em; color:#555; }
    body.dark-mode { background:#121212; color:#f5f5f5; transition:0.3s; }
    header.dark-mode, footer.dark-mode { background:#1e1e1e; }
    .hero.dark-mode, .categories.dark-mode, .recommendations.dark-mode, .signin-section.dark-mode { background:#1a1a1a; color:#f5f5f5; }
    .product.dark-mode { background:#1e1e1e; color:#f5f5f5; border-color:#444; }
    .circle.dark-mode img { background:#2a2a2a; }
    nav a.dark-mode { color:#f5f5f5; }
    .search-bar input.dark-mode { background:#2a2a2a; color:#f5f5f5; border:1px solid #555; }
    .search-bar button.dark-mode { background:#444; color:#fff; }
  </style>
</head>
<body>
<header>
  <div class="logo">MakeHive</div>
  <div class="search-bar">
    <input id="searchInput" type="text" placeholder="Search for products...">
    <button id="searchBtn">üîç</button>
  </div>
  <nav>
    <a href="about.html">About Us</a>
    <a href="cart.html">Cart üõí</a>
    <a href="profile.html">Profile üë§</a>
    <a href="#" class="seller-btn">Become a Seller</a>
  </nav>
  <button id="darkModeToggle" style="margin-left:20px;">üåô Dark Mode</button>
</header>

<section class="hero">
  <h1>We believe in Creativity & Simplicity.</h1>
  <p>Connecting small businesses with big opportunities.</p>
</section>

<section class="categories">
  <div class="circle"><img src="https://img.icons8.com/ios-filled/100/8B4513/sale.png" alt="Top Offers"><p>Top Offers</p></div>
  <div class="circle"><img src="https://img.icons8.com/ios-filled/100/8B4513/trophy.png" alt="Bestsellers"><p>Bestsellers</p></div>
  <div class="circle"><img src="images/poticon.png" alt="Handicrafts"><p>Handicrafts</p></div>
  <div class="circle"><img src="https://img.icons8.com/ios-filled/100/8B4513/t-shirt.png" alt="Fashion"><p>Fashion</p></div>
</section>

<section class="recommendations">
  <h2>Recommended for You</h2>
  <div class="scroll-container">
    <div class="product" data-id="1"><img src="images/handvase.jpg" alt="Handmade Vase"><p>Handmade Vase</p><span>499</span><button class="add-to-cart-btn" data-id="1">Add to Cart</button></div>
    <div class="product" data-id="2"><img src="images/crochet.jpg" alt="Crochet Bag"><p>Crochet Bag</p><span>799</span><button class="add-to-cart-btn" data-id="2">Add to Cart</button></div>
    <div class="product" data-id="3"><img src="images/scarf.jpg" alt="Handloom Scarf"><p>Handloom Scarf</p><span>1299</span><button class="add-to-cart-btn" data-id="3">Add to Cart</button></div>
  </div>
</section>

<section id="results" class="results-section" style="display:none;">
  <h2>Products Found</h2>
  <div id="businessList"></div>
</section>

<section class="signin-section">
  <p>For personalized recommendations ‚Äì Sign in</p>
  <button id="authBtn"></button>
  <p id="forgotLink" style="margin-top:5px; cursor:pointer; color:#ff4081; text-decoration:underline; display:none;">Forgot Password?</p>
</section>

<footer><p>¬© 2025 MakeHive. All rights reserved.</p></footer>

<script>
const authBtn = document.getElementById("authBtn");
const sellerBtn = document.querySelector(".seller-btn");
const resultsSection = document.getElementById("results");
const businessList = document.getElementById("businessList");

// Dark Mode
const darkModeToggle = document.getElementById("darkModeToggle");
function applyDarkMode(enable) {
  document.body.classList.toggle("dark-mode", enable);
  document.querySelector("header").classList.toggle("dark-mode", enable);
  document.querySelector("footer").classList.toggle("dark-mode", enable);
  document.querySelector(".hero").classList.toggle("dark-mode", enable);
  document.querySelector(".categories").classList.toggle("dark-mode", enable);
  document.querySelector(".recommendations").classList.toggle("dark-mode", enable);
  document.querySelector(".signin-section").classList.toggle("dark-mode", enable);
  document.querySelectorAll(".product").forEach(p => p.classList.toggle("dark-mode", enable));
  document.querySelectorAll(".circle").forEach(c => c.classList.toggle("dark-mode", enable));
  document.querySelectorAll("nav a").forEach(a => a.classList.toggle("dark-mode", enable));
  document.querySelectorAll(".search-bar input").forEach(i => i.classList.toggle("dark-mode", enable));
  document.querySelectorAll(".search-bar button").forEach(b => b.classList.toggle("dark-mode", enable));
}
darkModeToggle.addEventListener("click", ()=> {
  const isDark = !document.body.classList.contains("dark-mode");
  applyDarkMode(isDark);
  localStorage.setItem("darkMode", isDark);
});
if(localStorage.getItem("darkMode") === "true") applyDarkMode(true);

// Auth Button
function getToken() { return localStorage.getItem("token"); }

function updateAuthButton() {
  const token = getToken();
  const forgotLink = document.getElementById("forgotLink");

  if(token) {
    authBtn.textContent = "Logout";
    authBtn.onclick = () => { 
      localStorage.removeItem("token"); 
      alert("Logged out successfully!"); 
      updateAuthButton(); 
    };
    forgotLink.style.display = "none";
  } else {
    authBtn.textContent = "Sign In";
    authBtn.onclick = () => { window.location.href="login.html"; };
    forgotLink.style.display = "block";
    forgotLink.onclick = () => { window.location.href="forgot-password.html"; };
  }
}
updateAuthButton();

// Seller Button
sellerBtn.addEventListener("click",(e)=> {
  e.preventDefault();
  const token = getToken();
  if(token) window.location.href="become-seller.html";
  else { alert("Please sign in first!"); window.location.href="signup.html"; }
});

// Show search or category results
function showResults(title, products) {
  resultsSection.style.display="block";
  resultsSection.querySelector("h2").textContent = title;
  businessList.innerHTML="";
  const isDark = document.body.classList.contains("dark-mode");
  products.forEach(p => {
    businessList.innerHTML+=`
      <div class="product ${isDark?"dark-mode":""}" style="border:1px solid #ddd;padding:10px;margin:10px;display:inline-block;">
        <img src="${p.image}" alt="${p.name}" style="width:120px;height:120px;object-fit:cover;">
        <p>${p.name}</p>
        <span>‚Çπ${p.price}</span>
        <button class="add-to-cart-btn">Add to Cart</button>
      </div>`;
  });
  resultsSection.scrollIntoView({behavior:"smooth"});
}

// ‚úÖ Add to Cart with dynamic token
// ‚úÖ Add to Cart with dynamic token (ID-free)
document.addEventListener("click", async (e) => {
  if(e.target.classList.contains("add-to-cart-btn")){
    const token = getToken();
    if(!token){ alert("Please sign in first!"); return; }

    // Get product info from the DOM
    const productDiv = e.target.closest(".product");
    const name = productDiv.querySelector("p").textContent;
    const price = productDiv.querySelector("span").textContent.replace("‚Çπ", "");
    const image = productDiv.querySelector("img").src;

    try {
      const res = await fetch("http://localhost:5000/api/cart", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json", 
          "Authorization": "Bearer "+token 
        },
        body: JSON.stringify({ name, price, quantity: 1, image }) // ‚úÖ no productId
      });

      const data = await res.json();
      if(res.ok) alert("‚úÖ Product added to cart");
      else alert("‚ùå Failed: " + (data.error || JSON.stringify(data)));
    } catch(err){ 
      console.error("Fetch error:", err); 
      alert("‚ùå Network/server error"); 
    }
  }
});


const categories = {
  "Top Offers":[{name:"Discounted Vase",price:299,image:"images/handvase.jpg"},{name:"Festive Rakhi Pack",price:199,image:"images/rakhis.jpg"}],
  "Bestsellers":[{name:"Crochet Bag",price:799,image:"images/crochet.jpg"},{name:"Handloom Scarf",price:1299,image:"images/scarf.jpg"}],
  "Handicrafts":[{name:"Clay Pottery",price:349,image:"images/pottery.jpg"},{name:"DIY Handmade Card",price:899,image:"images/DIY.jpg"}],
  "Fashion":[{name:"Ethnic Handbag",price:1099,image:"images/crochet.jpg"},{name:"Traditional Scarf",price:1299,image:"images/scarf.jpg"}]
};
// Give each mock product a temporary unique ID
Object.keys(categories).forEach(cat => {
  categories[cat].forEach((p, index) => {
    if (!p._id) p._id = `mock-${cat}-${index}`;
  });
});



document.querySelectorAll(".categories .circle").forEach(circle=>{
  circle.addEventListener("click",()=>{ 
    const cat=circle.querySelector("p").textContent; 
    if(categories[cat]) showResults(cat,categories[cat]); 
  });
});

// Search
// Search (static + dynamic)
document.getElementById("searchBtn").addEventListener("click", async () => {
  const query = document.getElementById("searchInput").value.trim();
  if (!query) return;

  try {
    // Fetch combined static + dynamic products from your backend
    const response = await fetch(`http://localhost:5000/api/products/search?query=${encodeURIComponent(query)}`);
    const products = await response.json();

    if (products.length > 0) {
      showResults(`Search results for "${query}"`, products);
    } else {
      showResults(`Search results for "${query}"`, [{
        name: "No results found",
        price: "-",
        image: "images/default-banner.jpg",
        seller: ""
      }]);
    }
  } catch (err) {
    console.error(err);
    showResults(`Search results for "${query}"`, [{
      name: "Error fetching products",
      price: "-",
      image: "images/default-banner.jpg",
      seller: ""
    }]);
  }
});

</script>
</body>
</html>
