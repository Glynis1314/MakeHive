<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MakeHive - Payment</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .qr-box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; text-align: center; }
    .success-message { text-align: center; color: green; font-size: 1.2em; margin-top: 20px; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <header>
    <div class="logo">MakeHive</div>
    <div class="search-bar">
      <input type="text" placeholder="Search for products...">
      <button></button>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="cart.html">Cart</a>
      <a href="profile.html">Profile</a>
      <a href="#" class="seller-btn">Become a Seller</a>
    </nav>
  </header>

  <!-- Payment Section -->
  <section class="recommendations">
    <h2>Payment</h2>

    <div id="qr-section" style="max-width:500px;margin:20px auto;">
      <!-- QR codes will be dynamically inserted here -->
    </div>

    <div id="payment-success" class="success-message" style="display:none;">
      ✅ Payment Successful! Your order has been placed.
    </div>
  </section>

  <footer>
    <p>© 2025 MakeHive. All rights reserved.</p>
  </footer>

  <script>
    const qrSection = document.getElementById("qr-section");
    const successMessage = document.getElementById("payment-success");

    // Simulated data: In real scenario, fetch from cart or backend
    const qrData = JSON.parse(localStorage.getItem("qrData") || "[]");

    function renderQRCodes() {
      if(!qrData.length) {
        qrSection.innerHTML = "<p>No products selected for payment.</p>";
        return;
      }

      qrSection.innerHTML = "";
      qrData.forEach(seller => {
        const div = document.createElement("div");
        div.classList.add("qr-box");
        div.innerHTML = `
          <h4>${seller.sellerName} - Total: ₹${seller.total}</h4>
          <img src="${seller.qrCode}" alt="QR Code" style="width:200px; height:200px;"><br>
          <button class="pay-btn" data-seller="${seller.sellerId}" style="margin-top:10px;padding:10px 20px;cursor:pointer;">Mark as Paid</button>
        `;
        qrSection.appendChild(div);
      });

      document.querySelectorAll(".pay-btn").forEach(btn => {
        btn.addEventListener("click", markPaid);
      });
    }

    function markPaid(e) {
      const sellerId = e.target.dataset.seller;
      // Here, call backend to confirm payment for this seller if needed
      // For now, just simulate
      qrData.forEach(seller => {
        if(seller.sellerId === sellerId) seller.paid = true;
      });
      localStorage.setItem("qrData", JSON.stringify(qrData));

      // Check if all paid
      const allPaid = qrData.every(seller => seller.paid);
      if(allPaid) {
        qrSection.style.display = "none";
        successMessage.style.display = "block";
        // Optionally, clear cart in localStorage or redirect
      } else {
        renderQRCodes(); // Re-render remaining unpaid
      }
    }

    // Render QR codes on page load
    renderQRCodes();
  </script>
</body>
</html>